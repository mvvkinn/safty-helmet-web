<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.4.0/Chart.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src="https://cdn.socket.io/4.5.0/socket.io.min.js"></script>
<!DOCTYPE html>
<html>

<head>
	<meta charset="UTF-8">
	<link href="shcss.css" rel="stylesheet">
	<title>DASHBOARD_홍길동</title>
</head>

<body>
	<div class="dashboard_title_section">
		<div class="back_btn_section_2">
			<div class="back_btn_2" onclick="location.href='userListA.html'">
				< BACK </div>
			</div>
			<div class="dashboard_title">홍길동</div>
			<div class="report_btn_section">
				<div class="report_btn">긴급 신고</div>
			</div>
		</div>
		<div class="info_list_section">
			<div class="info_section" onclick="viewTemp();">
				<div class="info_title">기온</div>
				<div class="info_value" id="info_temp" style="color:#71FE8D;">27.3 ºC</div>
			</div>
			<div class="info_section" onclick="viewHum();">
				<div class="info_title">습도</div>
				<div class="info_value" id="info_humid" style="color:#518DDC;">45%</div>
			</div>
			<div class="info_section" onclick="viewLight();">
				<div class="info_title">광량</div>
				<div class="info_value" id="info_lightness" style="color:#FFFF9A;">6032 lx</div>
			</div>
			<div style="margin:15px;">
				<div class="info_title">충격량</div>
				<div class="info_value" id="info_shock" style="color:#585858;">OFF</div>
			</div>
		</div>
		<div id="graph_section">
			<canvas id="graph" height="75px"></canvas>
			<script>
				var options_temp = {
					type: 'line',
					data: {
						labels: ['00', '01', '02', '03', '04', '05', '06', '07', '08', '09', '10', '11', '12', '13', '14', '15', '16', '17', '18', '19', '20', '21', '22', '23', '24'],
						datasets: [{
							label: 'Temperatures',
							data: [13, 10, 8, 7, 6.5, 7, 8, 10, 12.5, 16, 20, 24, 26, 27, 27.3],
							backgroundColor: 'rgba(113, 254, 141, 0.4)',
							borderColor: 'rgba(113, 254, 141)',
							borderWidth: 1
						}]
					},
					options: {
						legend: {
							display: false
						},
						scales: {
							y: {
								beginAtZero: true
							}
						}
					}
				};
				var ctx = document.getElementById('graph').getContext('2d');
				var graph = Chart.Line(ctx, options_temp);

				var options_temp = {
					data: [13, 10, 8, 7, 6.5, 7, 8, 10, 12.5, 16, 20, 24, 26, 27, 27.3],
					backgroundColor: 'rgba(113, 254, 141, 0.4)',
					borderColor: 'rgba(113, 254, 141)',
					borderWidth: 1
				}
				var options_hum = {
					data: [40, 39, 38, 37, 41, 43, 42, 44, 40, 35, 38, 39, 43, 41, 45],
					backgroundColor: 'rgba(81, 141, 220, 0.4)',
					borderColor: 'rgba(81, 141, 220)',
					borderWidth: 1
				};
				var options_light = {
					data: [0, 0, 0, 0, 0, 0, 0, 0, 0, 5844, 6011, 5834, 5988, 6030, 6032],
					backgroundColor: 'rgba(255, 255, 154, 0.4)',
					borderColor: 'rgba(255, 255, 154)',
					borderWidth: 1
				};

				function changeData(chart, data) {
					var new_data = data.data;
					chart.data.datasets.push({
						data: new_data
					});
					chart.update();
				}

				function removeData(chart, data) {
					chart.data.datasets.pop({
						data: data
					});
					chart.update();
				}

				function viewTemp() {
					removeData(graph);
					changeData(graph, options_temp);
				}

				function viewHum() {
					removeData(graph);
					changeData(graph, options_hum);
				}

				function viewLight() {
					removeData(graph);
					changeData(graph, options_light);
				}
			</script>
		</div>
		<script>
			var socket = io.connect("http://localhost:3000");

			socket.on('msg', function (result) {
				$("#info_temp").html(parseFloat(result.temp).toFixed(2));
				$("#info_humid").html(parseFloat(result.humid).toFixed(2));
				$("#info_lightness").html(result.photoresistor + "lx");
				$("#info_shock").html(result);
			})

			$(document).ready(function () {
				$.ajax({
					url: "/getChartData",
					dataType: "json",
					type: "GET",
					success: function (result) {
						if (result) {
							$("#info_temp").html(parseFloat(result.temp).toFixed(2));
							$("#info_humid").html(parseFloat(result.humid).toFixed(2));
							$("#info_lightness").html(result.photoresistor + "lx");
							$("#info_shock").html(result);
						}
					}
				})
			})
		</script>
</body>

</html>